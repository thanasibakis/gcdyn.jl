#!/usr/bin/env python3

# Reads a list of sequences (separated by newlines)
# from stdin or a file passed as an argument,
# and writes the KD values to stdout.

import fileinput
from pathlib import Path

from gcdyn.phenotype import DMSPhenotype

model = DMSPhenotype(
    1,
    1,
    336,

    # https://github.com/jbloomlab/Ab-CGGnaive_DMS/blob/main/data/CGGnaive_sites.csv
    Path(__file__).parent / "support" / "CGGnaive_sites.csv",

    # https://github.com/matsengrp/gcdyn/blob/29-sampling/notebooks/tdms-linear.model
    Path(__file__).parent / "support" / "tdms-linear.model",

    ["delta_log10_KD", "delta_expression", "delta_psr"],
    -10.43,
)

for line in fileinput.input():
    sequence = line.strip()
    print(model.calculate_KD([sequence])[0])
